server:
  port: 5000
  servlet:
    context-path: /

spring:
  application:
    name: qmeetx-api-gateway

  cloud:
    gateway:
      default-filters:
        - RemoveResponseHeader=Server
      routes:



            #------Organization SERVICE------
            - id: organization-service-route
              uri: ${ORGANIZATION_SERVICE_URL:http://localhost:8081}
              predicates:
                - Path=/api/v1/organizations/**
              metadata:
                description: "Forward /api/v1/organizations/** to Organization Service"

            #------Queue SERVICE-------------
            - id: queue-service-route
              uri: ${QUEUE_SERVICE_URL:http://localhost:8082}
              predicates:
                - Path=/api/v1/queues/**
              metadata:
                description: "Forward /api/v1/queues/** to Queue Service"

            #------Appointment SERVICE-------
            - id: appointment-service-route
              uri: ${APPOINTMENT_SERVICE_URL:http://localhost:8083}
              predicates:
                - Path=/api/v1/appointments/**,/api/v1/seeder/**
              metadata:
                description: "Forward Appointments & Seeder to Appointment Service"

            #------Realtime SERVICE (WS)-----
            - id: realtime-service-route
              uri: ${REALTIME_SERVICE_URL:http://localhost:8084}
              predicates:
                - Path=/realtime/**
              metadata:
                description: "Forward WebSocket connections to Realtime Service"

            #------Authentication SERVICE----
            - id: authentication-service-route
              uri: ${AUTH_SERVICE_URL:http://localhost:5006}
              predicates:
                - Path=/api/auth/**
              metadata:
                description: "Forward /api/auth/** to Authentication Service"

            #------User SERVICE--------------
            - id: user-service-route
              uri: ${USER_SERVICE_URL:http://localhost:5004}
              predicates:
                - Path=/api/users/**
              metadata:
                description: "Forward /api/users/** to User Service"

            #------OTP SERVICE---------------
            - id: otp-service-route
              uri: ${OTP_SERVICE_URL:http://localhost:5001}
              predicates:
                - Path=/api/otp/**
              filters:
                - RewritePath=/api/otp/(?<segment>.*), /otp/$\{segment}
              metadata:
                description: "Forward /api/otp/** to OTP Service"

  webflux:
    base-path: /
    timeout: 10s

# ====================================
# JWT Validation Configuration
# ====================================
jwt:
 # auth-service-validate-url: http://localhost:5006/api/auth/validate
  header: Authorization
  prefix: Bearer




  public-key-path: classpath:keys/public_key.pem

  #---PUBLIC PATH THAT NO NEED AUTHENTICATION
  public-paths:
    - /api/auth/**
    - /docs/**
    - /swagger-ui/**
    - /health
    - /actuator/**
# ====================================
# Logging & Performance
# ====================================
logging:
  level:
    org.springframework.cloud.gateway: INFO
    reactor.netty.http.server: WARN
    com.qmeetx.apigateway: INFO

# ====================================
# Retry & Circuit Breaker (optional)
# ====================================
resilience4j:
  retry:
    instances:
      auth-service:
        max-attempts: 3
        wait-duration: 500ms
      patient-service:
        max-attempts: 3
        wait-duration: 500ms
  circuitbreaker:
    instances:
      auth-service:
        sliding-window-size: 10
        failure-rate-threshold: 50
        wait-duration-in-open-state: 5s
      patient-service:
        sliding-window-size: 10
        failure-rate-threshold: 50
        wait-duration-in-open-state: 5s
